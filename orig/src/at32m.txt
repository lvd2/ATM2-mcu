Версия прошивки 3.2m2 для контроллера
клавиатуры АТМ-2 ТУРБО.

07/12/2019
Версия прошивки с исправленными константами скоростей
работы порта RS232.

15/11/2019
Версия прошивки с увеличенной до 16 байт глубиной стека.

26/10/06
1.   В этой версии увеличена длительность выдачи
скан-кода клавиатуры на шину данных Z80, что
обеспечивает устойчивую работу контроллера
на частотах выше 10 мгц.
---
Примечание:
      В существующей прошивке скан-код клавиатуры
выдается на шину Z80 командой movx @DPTR,A
      Длительность сигнала /VWR при тактовой частоте
11.0592 МГц в режиме выдачи по команде movx = 0.5 мксек.
В это время данные из порта P0 микроконтроллера передаются
через регистр на шину данных Z80. При слишком коротком
импульсе (при высокой тактовой частоте МК) этого времени
недостаточно для удержания данных на шине Z80, что
приводит к неустойчивому считыванию скан-кода клавиатуры.
      Обьясняется это тем, что с момента снятия /WAIT
процессора, до завершения цикла чтения порта клавиатуры
при тактовой частоте процессора Z80 = 3.5 MHz проходит
от 0.4 до 0.7 мксек (при независимом тактировании Z80
и МК). Этого явно не достаточно для надежного чтения
скан-кода выдаваемого МК на шину данных Z80.
      Если управлять битом /VWR на прямую, длительность
при той-же тактовой получилась 1.1 мксек. Этого
вполне достаточно для устойчивой работы системы.
      Сейчас сделано так:
      mov P0,A	;это скан код в порт
      clr VWR 	;импульс на выводе
      setb VWR	; линии записи МК
---
2.   Изменен алгоритм выдачи синала RESET при
включении питания, что надеюсь исправит
ситуацию с перезапуском АТМ от контроллера.

3. Добавлена работа с портом RS232 и модемом через него.

Кварц желательно установить на 11.0592 Мгц.
В принципе можно пересчитать константы и для другой
частоты кварца, но я думаю это не рационально.


27/03/05
========
Версия прошивки 2.2 для микроконтроллера серии MSC51.


1 Теперь в двух последних байтах, хранящих номер версии
  записываются двоичные коды соответствующие тактовой
  частоте контроллера.
  Тоесть все 4 байта будут записаны так:
  F =  7.0000 Мгц - 2,2,0,7
  F = 11.0592 Мгц - 2,2,1,1
  F = 12.0000 Мгц - 2,2,1,2
  Увеличивать тактовую частоту выше 14 Мгц не
  рекомендуется, так как при этом не гарантируется
  надежное чтение кода клавиатуры, выдаваемое на шину
  Спектрума от контроллера в его цикле записи (слишком
  коротким оказывается сигнал /VWR).

2 При включении питания микроконтроллер выдает на Z80
  сигнал /RESET, обеспечивая надежный старт компьютера.

3 Оптимизирована процедура прерывания по запросу кода
  клавиатуры.

4 Исправлена ошибка перехода в режим WAIT по нажатию
  клавиши Pause/Break.


Kamil Karimov  k2k@list.ru

26 октября 2006 года
Камиль Каримов

